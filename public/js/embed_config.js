// Generated by CoffeeScript 1.7.1
(function() {
  require.config({
    baseUrl: '//cdnjs.cloudflare.com/ajax/libs/',
    shim: {
      jquery: {
        exports: '$',
        init: function() {
          var local;
          local = this.jQuery.noConflict(true);
          return local;
        }
      },
      underscore: {
        exports: '_',
        init: function() {
          var local;
          local = this._.noConflict();
          return local;
        }
      },
      backbone: {
        exports: 'Backbone',
        deps: ['underscore', 'jquery'],
        init: function() {
          var local;
          local = this.Backbone.noConflict();
          return local;
        }
      },
      'jquery.primer': {
        deps: ['jquery']
      },
      'jquery.flot': {
        deps: ['jquery'],
        exports: '$.plot'
      },
      'jquery.flot.pie': {
        deps: ['jquery.flot']
      },
      'jquery.flot.selection': {
        deps: ['jquery.flot']
      },
      'select2': {
        deps: ['jquery']
      },
      mustache: {
        exports: 'Mustache'
      }
    },
    paths: {
      jquery: 'jquery/1.11.0/jquery',
      jqueryMigrate: 'jquery-migrate/1.2.1/jquery-migrate.min',
      mustache: 'mustache.js/0.7.2/mustache.min',
      underscore: 'underscore.js/1.5.2/underscore-min',
      backbone: 'backbone.js/1.1.0/backbone-min',
      excanvas: 'flot/0.8.2/excanvas.min',
      'jquery.flot': 'flot/0.8.2/jquery.flot.min',
      'jquery.flot.pie': 'flot/0.8.2/jquery.flot.pie.min',
      'jquery.flot.selection': 'flot/0.8.2/jquery.flot.selection.min',
      select2: 'select2/3.4.5/select2.min',
      esbb: window.LRWidget.domain + '/js/es-backbone'
    },
    map: {
      '*': {},
      'jquery-private': {
        'jquery': 'jquery'
      }
    },
    urlArgs: "bust=" + new Date().getTime()
  });

  require(['jquery', 'underscore', 'esbb/es-backbone', 'esbb/simple-view'], function($, _, ESBB, ESBBApp) {
    var WidgetConfig;
    WidgetConfig = window.LRWidget || {
      api_key: '',
      domain: ''
    };
    return $('.lr-embed').each(function() {
      $(this).html('Loading...');
      return $.ajax(WidgetConfig.domain + '/api/embed/widget?jsonp=?', {
        dataType: 'jsonp',
        data: {
          widget_key: $(this).data('widgetKey'),
          api_key: WidgetConfig.api_key
        }
      }).done((function(_this) {
        return function(t) {
          var esbbSimpleApp, queryModel, resultsModel;
          $(_this).html(t.templates.core);
          resultsModel = new ESBB.SearchResultsModel();
          queryModel = new ESBBApp.SearchQueryProxyModel({
            config: {
              search_url: WidgetConfig.domain + '/api/search?api_key=' + WidgetConfig.api_key + '&jsonp=?',
              index: 'lr',
              index_type: 'lr_doc'
            },
            limit: 10,
            query: '',
            facets: t.settings.show_facets ? ['url_domain', 'keys', 'publisher_full'] : [],
            filter_keys: t.settings.filters || [],
            highlight: ['description']
          });
          queryModel.resultsModel = resultsModel;
          return esbbSimpleApp = new ESBBApp.SimpleAppView({
            model: resultsModel,
            query: queryModel,
            el: $(_this),
            id_prefix: 'esbb-simple',
            globalConfig: WidgetConfig,
            widgetConfig: t
          });
        };
      })(this));
    });
  });

}).call(this);
